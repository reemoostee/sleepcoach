
<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-uWxY/CJNBR+1zjPWmfnSnVxwRheevXITnMqoEIeG1LJrdI0GlVs/9cVSyPYXdcSF" crossorigin="anonymous">
	<link rel="shortcut icon" href="#">
	<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	<script src="https://kit.fontawesome.com/626bd02c25.js" crossorigin="anonymous"></script>
	
	<!-- Matomo -->
	<script>
	  var _paq = window._paq = window._paq || [];
	  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
	  _paq.push(['trackPageView']);
	  _paq.push(['enableLinkTracking']);
	  (function() {
		var u="//e93udypgd.preview.infomaniak.website/";
		_paq.push(['setTrackerUrl', u+'piwik.php']);
		_paq.push(['setSiteId', '1']);
		var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
		g.async=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
	  })();
	</script>
	<!-- End Matomo Code -->

    <title>Sleep Coach</title>
  </head>
  <body>

	<nav class="navbar navbar-dark bg-dark">
	  <div class="container-fluid">
		<a class="navbar-brand" href="../"><i class="fas fa-bed"></i> Sleep Coach</a>
		<!--<span id="nof" class="float-right badge bg-light text-dark">0</span>-->
	  </div>
	</nav>


	<div class="card mb-5 rounded-0">
		<div class="card-header">
			<h5 class="card-title display-6">Schlafqualität</h5>
		</div>
		<div class="card-body">
			<p class="card-text">Wir erfassen die Schlafqualität, damit wir erkennen können, welche Faktoren sich bei Dir am stärksten auswirken.
				<br/>Idealerweise erfasst du täglich nach dem Aufstehen deine Wahrnehmung zu den aufgeführten Faktoren.
			</p>		
		</div>
		<div id="errorDiv" class="p-3 mb-2 bg-danger text-white">
			<p class="card-text">Bitte verwende einen gültigen Zugangslink für den Aufruf der Seite.</p>
		</div>
		<div  style="display:none" class="card-footer accessTokenHidden">
			<i class="fas fa-info-circle"></i> Die Schlafqualität wird unter verschiedenen Aspekten bewertet, wie z. B. Schlafdauer, Schlaftiefe, Aufstehen nach dem Schlaf, Zustand nach dem Schlaf, Schlafmenge und Zufriedenheit mit dem Schlaf.
			<br/><br/></i> Über das <i class="fas fa-bed"></i>-Icon ganz oben links gelangst Du wieder auf die Startseite.
		</div>
	</div>
	
<div class="container accessTokenHidden" style="display:none">
	<form action="#" id="qform">
	
	
	<div class="card border-warning">
		<div class="card-header bg-warning">
			<h5 class="card-title">Nach der letzten Nacht</h5>
		</div>
		<div class="card-body">
			<p class="card-text">Wie bewertest Du den Schlaf der letzten Nacht?</p>
		</div>
	</div>

	<div class="card border-primary mb-5" style="border: none;">
		<div class="card-body px-0 pb-0">

			<div class="form-group">
				<div class="d-grid gap-2">
					
					<div>
						<label for="restorationAfterSleep" class="form-label mb-0 small"><strong class="text-primary">a</strong> Erholt nach dem Schlaf</label>
						<div class="input-group input-group input-group-lg">
							
							<select class="form-select col-10" id="restorationAfterSleep" aria-label="Restoration after sleep" required>
								<option value="" selected>Auswahl ...</option>
								<option value="0">Selten</option>
								<option value="1">Manchmal</option>
								<option value="2">Oft</option>
								<option value="3">Beinahe immer</option>
							</select>
							
							<button type="button" class="btn btn-outline-primary btn-lg col-2" data-bs-toggle="modal" data-bs-target="#questionModalrestorationAfterSleep"><i class="fas fa-question"></i></button>

						</div>
					</div>

					
					<div class="modal fade" id="questionModalrestorationAfterSleep" tabindex="-1" aria-labelledby="questionModalrestorationAfterSleepLabel" aria-hidden="true">
						<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
							<h5 class="modal-title" id="questionModalrestorationAfterSleepLabel">Erholt nach dem Schlaf</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
							<p>Erfasse bitte wie oft du dich nach dem Schlaf erholt fühlst.</p>
							</div>
							<div class="modal-footer">
							<button type="button" class="btn btn-outline-secondary btn-lg col-12" data-bs-dismiss="modal">Ok</button>
							</div>
						</div>
						</div>
					</div>
					
					<div>
						<label for="difficultyInFallingAsleep" class="form-label mb-0 small"><strong class="text-primary">b</strong> Mühe beim Einschlafen</label>
						<div class="input-group input-group input-group-lg">
							
							<select class="form-select col-10" id="difficultyInFallingAsleep" aria-label="Difficulty in falling asleep" required>
								<option value="" selected>Auswahl ...</option>
								<option value="0">Selten</option>
								<option value="1">Manchmal</option>
								<option value="2">Oft</option>
								<option value="3">Beinahe immer</option>
							</select>
							
							<button type="button" class="btn btn-outline-primary btn-lg col-2" data-bs-toggle="modal" data-bs-target="#questionModaldifficultyInFallingAsleep"><i class="fas fa-question"></i></button>

						</div>
					</div>

					
					<div class="modal fade" id="questionModaldifficultyInFallingAsleep" tabindex="-1" aria-labelledby="questionModaldifficultyInFallingAsleepLabel" aria-hidden="true">
						<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
							<h5 class="modal-title" id="questionModaldifficultyInFallingAsleepLabel">Mühe beim Einschlafen</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
							<p>Erfasse bitte wie oft du Mühe beim Einschlafen hast.</p>
							</div>
							<div class="modal-footer">
							<button type="button" class="btn btn-outline-secondary btn-lg col-12" data-bs-dismiss="modal">Ok</button>
							</div>
						</div>
						</div>
					</div>

					<div>
						<label for="difficultyInGettingUp" class="form-label mb-0 small"><strong class="text-primary">c</strong> Mühe beim Aufstehen</label>
						<div class="input-group input-group input-group-lg">
							
							<select class="form-select col-10" id="difficultyInGettingUp" aria-label="Difficulty in getting up" required>
								<option value="" selected>Auswahl ...</option>
								<option value="0">Selten</option>
								<option value="1">Manchmal</option>
								<option value="2">Oft</option>
								<option value="3">Beinahe immer</option>
							</select>
							
							<button type="button" class="btn btn-outline-primary btn-lg col-2" data-bs-toggle="modal" data-bs-target="#questionModaldifficultyInGettingUp"><i class="fas fa-question"></i></button>

						</div>
					</div>
					
					
					
					<div class="modal fade" id="questionModaldifficultyInGettingUp" tabindex="-1" aria-labelledby="questionModaldifficultyInGettingUpLabel" aria-hidden="true">
						<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
							<h5 class="modal-title" id="questionModaldifficultyInGettingUpLabel">Mühe beim Aufstehen</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
							<p>Erfasse bitte wie oft du Mühe beim Aufstehen hast.</p>
							</div>
							<div class="modal-footer">
							<button type="button" class="btn btn-outline-secondary btn-lg col-12" data-bs-dismiss="modal">Ok</button>
							</div>
						</div>
						</div>
					</div>

					<div>
						<label for="satisfactionWithSleep" class="form-label mb-0 small"><strong class="text-primary">d</strong> Zufrieden mit der Schlafqualität</label>
						<div class="input-group input-group input-group-lg">
							
							<select class="form-select col-10" id="satisfactionWithSleep" aria-label="Satisfaction with sleep" required>
								<option value="" selected>Auswahl ...</option>
								<option value="0">Selten</option>
								<option value="1">Manchmal</option>
								<option value="2">Oft</option>
								<option value="3">Beinahe immer</option>
							</select>
							
							<button type="button" class="btn btn-outline-primary btn-lg col-2" data-bs-toggle="modal" data-bs-target="#questionModalsatisfactionWithSleep"><i class="fas fa-question"></i></button>

						</div>
					</div>	
					
					
					<div class="modal fade" id="questionModalsatisfactionWithSleep" tabindex="-1" aria-labelledby="questionModalsatisfactionWithSleepLabel" aria-hidden="true">
						<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
							<h5 class="modal-title" id="questionModalsatisfactionWithSleepLabel">Zufrieden mit der Schlafqualität</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
							<p>Erfasse bitte wie oft du mit deiner Schlafqualität zufrieden bist.</p>
							</div>
							<div class="modal-footer">
							<button type="button" class="btn btn-outline-secondary btn-lg col-12" data-bs-dismiss="modal">Ok</button>
							</div>
						</div>
						</div>
					</div>


					<div>
						<label for="difficultyInMaintainingSleep" class="form-label mb-0 small"><strong class="text-primary">e</strong> Schwierigkeiten durchzuschlafen</label>
						<div class="input-group input-group input-group-lg">
							
							<select class="form-select col-10" id="difficultyInMaintainingSleep" aria-label="Difficulty in maintaining sleep" required>
								<option value="" selected>Auswahl ...</option>
								<option value="0">Selten</option>
								<option value="1">Manchmal</option>
								<option value="2">Oft</option>
								<option value="3">Beinahe immer</option>
							</select>
							
							<button type="button" class="btn btn-outline-primary btn-lg col-2" data-bs-toggle="modal" data-bs-target="#questionModalDifficultyInMaintainingSleep"><i class="fas fa-question"></i></button>

						</div>
					</div>
					
					
					<div class="modal fade" id="questionModalDifficultyInMaintainingSleep" tabindex="-1" aria-labelledby="questionModalDifficultyInMaintainingSleepLabel" aria-hidden="true">
						<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
							<h5 class="modal-title" id="questionModalDifficultyInMaintainingSleepLabel">Schwierigkeiten durchzuschlafen</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
							</div>
							<div class="modal-body">
							<p>Erfasse bitte wie oft du Schwierigkeiten durchzuschlafen hast.</p>
							</div>
							<div class="modal-footer">
							<button type="button" class="btn btn-outline-secondary btn-lg col-12" data-bs-dismiss="modal">Ok</button>
							</div>
						</div>
						</div>
					</div>


				</div>
			</div>
			
		</div>
	</div>	

	<div class="card border-warning">
		<div class="card-header bg-warning">
			<h5 class="card-title">Speichern</h5>
		</div>
		<div class="card-body">
			<p class="card-text">Für welche Nacht gelten die Angaben oben und um welche Zeit bist Du am darauf folgenden Tag aufgestanden?</p>
		</div>
	</div>
	
	<div class="card border-warning mb-5" style="border: none;">
		<div class="card-body px-0 pb-0">

			<div class="form-group">
				<div class="d-grid gap-2">
				
					<div>
						<label for="date" class="form-label mb-0 small">Angaben für Nacht vom ... und Zeit vom Aufstehen.</label>
						<div class="input-group input-group input-group-lg">
							
							<input type="date" class="form-control col-5" id="date" aria-label="Nacht vom" />
							
							<input type="time" class="form-control col-5" id="time" aria-label="Zeit vom Aufstehen" />
							
							<button type="button" class="btn btn-outline-primary btn-lg col-2" data-bs-toggle="modal" data-bs-target="#questionModalDateTime"><i class="fas fa-question"></i></button>

						</div>
					</div>
				
					<button id="buttonSave" class="btn btn-outline-primary btn-lg mt-1" type="submit">Speichern <i class="far fa-save"></i></button>
				</div>
			</div>

			
			<div class="modal fade" id="questionModalDateTime" tabindex="-1" aria-labelledby="questionModalDateTimeLabel" aria-hidden="true">
				<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
					<h5 class="modal-title" id="questionModalDateTimeLabel">Informationen zu Datum/Uhrzeit</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
					<p>Bitte erfasse das Datum der Nacht auf die sich deine Angaben beziehen und wann du am darauf folgenden Tag aufgestanden bist.</p>
					</div>
					<div class="modal-footer">
					<button type="button" class="btn btn-outline-secondary btn-lg col-12" data-bs-dismiss="modal">Ok</button>
					</div>
				</div>
				</div>
			</div>
			
		</div>
	</div>



</form>
</div>

	<script>
		$(document).ready(function() {

			//"localhost:3000/?a=15a4522e-34d0-11ec-8d3d-0242ac130003"

			$('.accessTokenHidden').hide();
			$('#errorDiv').hide();

			var accessToken = GetURLParameter('a');
			console.log("Param: "+accessToken);
			var data = {};
			data["accessToken"] = accessToken;

			$.ajax({
				type: 'POST',
				contentType: "application/json",
				data: JSON.stringify(data),
				url: '/checkAccessTokenValidity',
				success: function(data) {
					var response = JSON.parse(data);
					if (response["accessTokenValid"]){
						$('a[href*="../"]').attr("href", "../?a="+accessToken);
						$('.accessTokenHidden').show();
						$('#errorDiv').hide();
					} else {
						$('.accessTokenHidden').hide();
						$('#errorDiv').show();
					}
					

				},
				error: function(data) {
				}
			});

			//save-event
			$('#buttonSave').click(function(e) {

				if (this.form.checkValidity()) {

					var data = {};

					data["accessToken"] = GetURLParameter('a');	

					data['date'] = $('#date').val();
					data['time'] = $('#time').val();
					
					$(".form-select").each(function(){
						data[this.id] = $(this).find(":selected").val();
					});
					
					e.preventDefault();
					$.ajax({
						type: 'POST',
    					contentType: "application/json",
    					data:JSON.stringify(data),
						url: '/quality/insertdata',
						success: function(data) {
							$("#qform").trigger("reset");
							swal.fire({
								title: 'Danke',
								text: 'Deine Antworten wurden erfolgreich gespeichert.',
								icon: 'success'
							});

						},
						error: function(data) {
							swal.fire({
								title: 'Speichern fehlgeschlagen',
								text: 'Es ist ein Fehler beim Speichern aufgetreten',
								icon: 'error'
							});
						}
					});

				} else {
					swal.fire({
						title: 'Fehlende Antworten',
						text: 'Bitte beantworte alle Fragen',
						icon: 'error'
					});
				}
			});
		});

		function GetURLParameter(sParam)
		{
			var sPageURL = window.location.search.substring(1);
			var sURLVariables = sPageURL.split('&');
			for (var i = 0; i < sURLVariables.length; i++) 
			{
				var sParameterName = sURLVariables[i].split('=');
				if (sParameterName[0] == sParam) 
				{
					return sParameterName[1];
				}
			}
		}
	</script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-kQtW33rZJAHjgefvhyyzcGF3C5TFyBQBA13V1RKPf4uH+bwyzQxZ6CmMZHmNBEfJ" crossorigin="anonymous"></script>
  </body>
</html>